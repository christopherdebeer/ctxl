<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ctxl — You Are The Component</title>

    <!-- Import map: bare imports resolved for compiled VFS modules (blob ESM) -->
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.3.1",
          "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime",
          "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
          "react-refresh/runtime": "/vendor/vendor-react-refresh.js",
          "styled-components": "https://esm.sh/styled-components@6?deps=react@18.3.1,react-dom@18.3.1&external=react,react-dom"
        }
      }
    </script>

    <style>
      html, body { height: 100%; margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }

      /* Agent-first layout: preview takes full viewport */
      #shell { display: grid; grid-template-columns: 1fr; grid-template-rows: 1fr; height: 100%; }

      /* Dev drawer - hidden by default, slides in from left */
      #left {
        position: fixed;
        left: 0; top: 0; bottom: 0;
        width: 50vw;
        transform: translateX(-100%);
        transition: transform 0.2s ease;
        z-index: 100;
        background: #fff;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        display: grid;
        grid-template-rows: auto auto auto 1fr auto;
      }
      #left.open { transform: translateX(0); }

      /* Backdrop overlay when drawer is open */
      #drawerBackdrop {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.3);
        z-index: 99;
      }
      #drawerBackdrop.visible { display: block; }

      #toolbar { display: flex; gap: 8px; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
      #closeDrawerBtn {
        margin-left: auto;
        background: none; border: none; cursor: pointer;
        font-size: 18px; color: #999; padding: 4px 8px; border-radius: 4px;
        line-height: 1;
      }
      #closeDrawerBtn:hover { background: #f0f0f0; color: #333; }

      /* Drawer internal tabs (Code | Inspect) */
      #drawerTabs {
        display: flex; gap: 0; padding: 0 10px;
        border-bottom: 1px solid #eee; background: #fafafa;
      }
      .drawerTab {
        padding: 8px 16px; border: none; background: none;
        cursor: pointer; font-size: 13px; font-weight: 500;
        color: #888; border-bottom: 2px solid transparent;
        transition: color 0.15s, border-color 0.15s;
      }
      .drawerTab:hover { color: #333; }
      .drawerTab.active { color: #333; border-bottom-color: #667eea; }

      #status { padding: 8px 10px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono"; font-size: 12px; border-bottom: 1px solid #eee; white-space: pre-wrap; }

      /* Drawer content area — editor and inspect share the slot */
      #drawerContent { position: relative; overflow: hidden; }
      #editor { width: 100%; height: 100%; overflow: hidden; box-sizing: border-box; }
      #drawerInspect {
        display: none;
        position: absolute; inset: 0;
        overflow-y: auto; padding: 16px; box-sizing: border-box;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 13px; color: #333; background: #fff;
      }
      #drawerInspect.active { display: block; }
      #drawerLog {
        display: none;
        position: absolute; inset: 0;
        overflow-y: auto; padding: 12px; box-sizing: border-box;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 12px; color: #333; background: #fff;
      }
      #drawerLog.active { display: block; }
      #drawerLog .log-entry { margin-bottom: 12px; border: 1px solid #eee; border-radius: 6px; overflow: hidden; }
      #drawerLog .log-header {
        padding: 6px 10px; background: #f8f8fa; border-bottom: 1px solid #eee;
        display: flex; gap: 8px; align-items: center; font-size: 11px; cursor: pointer;
      }
      #drawerLog .log-header:hover { background: #f0f0f5; }
      #drawerLog .log-source { font-weight: 600; color: #667eea; }
      #drawerLog .log-source.author { color: #e06c75; }
      #drawerLog .log-source.dispatch { color: #d19a66; }
      #drawerLog .log-time { color: #999; margin-left: auto; }
      #drawerLog .log-duration { color: #888; }
      #drawerLog .log-error { color: #c00; font-weight: 600; }
      #drawerLog .log-body { display: none; padding: 8px 10px; font-size: 11px; white-space: pre-wrap; word-break: break-all; max-height: 300px; overflow-y: auto; background: #fafafa; }
      #drawerLog .log-body.open { display: block; }
      #drawerLog .log-pill { padding: 1px 6px; border-radius: 3px; font-size: 10px; font-weight: 500; }
      #drawerLog .log-pill.tool-use { background: #e8f0fe; color: #1a73e8; }
      #drawerLog .log-pill.text { background: #e6f4ea; color: #137333; }
      #drawerLog .log-pill.error { background: #fce8e6; color: #c5221f; }
      #drawerLog .log-empty { color: #aaa; font-style: italic; padding: 20px; text-align: center; }
      #files { padding: 8px 10px; border-top: 1px solid #eee; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
      #files button { font-family: ui-monospace, monospace; font-size: 12px; padding: 6px 8px; border: 1px solid #ddd; background: #fff; cursor: pointer; border-radius: 6px; }
      #files button[data-active="true"] { border-color: #000; }

      /* Preview takes full space */
      #right { display: grid; grid-template-rows: auto 1fr; height: 100%; }
      #previewTop { padding: 10px; border-bottom: 1px solid #eee; display: flex; gap: 8px; align-items: center; }
      #preview { height: 100%; position: relative; }
      #root { height: 100%; }

      /* View mode tabs */
      .viewTabs { display: flex; gap: 0; margin-right: auto; }
      .viewTab {
        padding: 6px 14px;
        border: 1px solid #ddd;
        background: #fff;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        transition: background 0.15s, border-color 0.15s;
      }
      .viewTab:first-child { border-radius: 6px 0 0 6px; }
      .viewTab:last-child { border-radius: 0 6px 6px 0; }
      .viewTab:not(:first-child) { border-left: none; }
      .viewTab:hover { background: #f5f5f5; }
      .viewTab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border-color: #667eea; }
      .viewTab.active + .viewTab { border-left-color: #667eea; }

      /* About view */
      #about {
        display: none;
        height: 100%;
        overflow-y: auto;
        padding: 32px;
        box-sizing: border-box;
      }
      #about.active { display: block; }
      #root.hidden { display: none; }

      /* Inspect view (inside drawer) */
      #drawerInspect .section { margin-bottom: 20px; }
      #drawerInspect .section-title {
        font-weight: 600; font-size: 13px; color: #555; text-transform: uppercase;
        letter-spacing: 0.05em; margin-bottom: 8px; padding-bottom: 4px;
        border-bottom: 1px solid #eee;
      }
      #drawerInspect .entry {
        padding: 6px 8px; margin-bottom: 2px; border-radius: 4px; background: #f8f8f8;
        display: flex; gap: 8px; align-items: baseline;
      }
      #drawerInspect .entry-key { font-weight: 600; color: #667eea; min-width: 100px; }
      #drawerInspect .entry-val { color: #666; word-break: break-all; }
      #drawerInspect .mutation {
        padding: 8px; margin-bottom: 4px; border-radius: 4px;
        border-left: 3px solid #667eea; background: #f8f8fa;
      }
      #drawerInspect .mutation.rollback { border-left-color: #c00; }
      #drawerInspect .mutation .trigger { font-weight: 500; color: #333; }
      #drawerInspect .mutation .meta { font-size: 11px; color: #999; margin-top: 2px; }
      #drawerInspect .empty { color: #aaa; font-style: italic; }

      /* Markdown styling */
      #about .markdown-body {
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.7;
      }
      #about h1 { font-size: 2rem; font-weight: 300; margin-bottom: 0.5rem; }
      #about h2 { font-size: 1.4rem; margin-top: 2.5rem; padding-bottom: 0.3rem; border-bottom: 1px solid #eee; }
      #about h3 { font-size: 1.1rem; margin-top: 1.5rem; }
      #about p { margin: 1rem 0; }
      #about code { background: #f5f5f5; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; }
      #about pre { background: #f8f8f8; padding: 16px; border-radius: 8px; overflow-x: auto; }
      #about pre code { background: none; padding: 0; }
      #about table { border-collapse: collapse; width: 100%; margin: 1rem 0; }
      #about th, #about td { border: 1px solid #ddd; padding: 8px 12px; text-align: left; }
      #about th { background: #f8f8f8; }
      #about blockquote { border-left: 3px solid #667eea; margin: 1rem 0; padding-left: 1rem; color: #666; }
      #about hr { border: none; border-top: 1px solid #eee; margin: 2rem 0; }
      #about ul, #about ol { padding-left: 1.5rem; }
      #about li { margin: 0.3rem 0; }

      .pill { font-size: 12px; padding: 2px 8px; border: 1px solid #ddd; border-radius: 999px; }
      .warn { border-color: #f0c36d; background: #fff7e6; }
      .err  { border-color: #ff9a9a; background: #fff0f0; }

      /* Dev toggle button */
      #devToggle {
        padding: 6px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        background: #fff;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: background 0.15s, border-color 0.15s;
      }
      #devToggle:hover { background: #f5f5f5; border-color: #ccc; }
      #devToggle.active { background: #f0f0f0; border-color: #999; }

      /* Unsaved indicator dot */
      #devToggle .indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: none;
      }
      #devToggle.unsaved .indicator {
        display: block;
        background: #f0c36d;
      }
      #devToggle.building .indicator {
        display: block;
        background: #667eea;
        animation: pulse 1s infinite;
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.4; }
      }

      /* Mobile viewport */
      @media (max-width: 768px) {
        #left { width: 100vw; }
        #toolbar { flex-wrap: wrap; }
        #toolbar button { min-height: 44px; min-width: 44px; padding: 10px 16px; }
        #closeDrawerBtn { min-height: 44px; min-width: 44px; font-size: 22px; }
        .drawerTab { min-height: 44px; padding: 10px 16px; }
        #files { overflow-x: auto; flex-wrap: nowrap; -webkit-overflow-scrolling: touch; }
        #files button { min-height: 44px; flex-shrink: 0; }
        #editor { min-height: 200px; overflow: hidden; }
        #previewTop { flex-wrap: wrap; }
        #devToggle { min-height: 44px; min-width: 44px; }
        .viewTab { min-height: 44px; display: flex; align-items: center; }
        #about { padding: 16px; }
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  </head>
  <body>
    <script>eruda.init();</script>
    <div id="shell">
      <!-- Backdrop for drawer -->
      <div id="drawerBackdrop"></div>

      <!-- Dev drawer (hidden by default) -->
      <div id="left">
        <div id="toolbar">
          <strong>VFS</strong>
          <span class="pill" id="modePill">idle</span>
          <button id="runBtn">Build & Run</button>
          <button id="resetBtn">Reset</button>
          <button id="settingsBtn">API</button>
          <span style="opacity:.7;font-size:12px">Ctrl/Cmd+S builds</span>
          <button id="closeDrawerBtn" aria-label="Close drawer">&times;</button>
        </div>
        <div id="drawerTabs">
          <button class="drawerTab active" data-drawer="code">Code</button>
          <button class="drawerTab" data-drawer="inspect">Inspect</button>
          <button class="drawerTab" data-drawer="log">Log</button>
        </div>
        <div id="settings" style="display:none; padding:10px; border-bottom:1px solid #eee; background:#f9f9f9;">
          <div style="margin-bottom:8px;">
            <label style="font-size:12px;font-weight:500;">API Mode:</label>
            <select id="apiModeSelect" style="margin-left:8px; padding:4px;">
              <option value="none">None (disabled)</option>
              <option value="anthropic">Anthropic Direct</option>
              <option value="proxy">Proxy Server</option>
            </select>
          </div>
          <div style="margin-bottom:8px;">
            <label style="font-size:12px;font-weight:500;">Model:</label>
            <select id="modelSelect" style="margin-left:8px; padding:4px; width:250px;">
              <option value="claude-opus-4-6">Claude Opus 4.6</option>
              <option value="claude-sonnet-4-5-20250929">Claude Sonnet 4.5</option>
              <option value="claude-haiku-4-5-20251001">Claude Haiku 4.5</option>
              <option value="claude-opus-4-5-20251101">Claude Opus 4.5</option>
              <option value="claude-opus-4-1-20250805">Claude Opus 4.1</option>
              <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
              <option value="claude-3-7-sonnet-20250219">Claude Sonnet 3.7</option>
              <option value="claude-opus-4-20250514">Claude Opus 4</option>
              <option value="claude-3-haiku-20240307">Claude Haiku 3</option>
            </select>
          </div>
          <div id="apiKeyRow" style="display:none; margin-bottom:8px;">
            <label style="font-size:12px;font-weight:500;">API Key:</label>
            <input type="password" id="apiKeyInput" style="margin-left:8px; padding:4px; width:200px;" placeholder="sk-ant-...">
          </div>
          <div id="proxyUrlRow" style="display:none; margin-bottom:8px;">
            <label style="font-size:12px;font-weight:500;">Proxy URL:</label>
            <input type="text" id="proxyUrlInput" style="margin-left:8px; padding:4px; width:250px;" placeholder="http://localhost:3001/api/chat">
          </div>
          <button id="saveSettingsBtn" style="padding:4px 12px;">Save</button>
          <span id="settingsStatus" style="margin-left:8px; font-size:12px; color:#666;"></span>
        </div>
        <div id="status"></div>
        <div id="drawerContent">
          <div id="editor"></div>
          <div id="drawerInspect"></div>
          <div id="drawerLog"></div>
        </div>
        <div id="files"></div>
      </div>

      <!-- Agent preview (full viewport) -->
      <div id="right">
        <div id="previewTop">
          <button id="devToggle">Dev<span class="indicator"></span></button>
          <div class="viewTabs">
            <button class="viewTab active" data-view="component">Component</button>
            <button class="viewTab" data-view="about">About</button>
          </div>
          <span class="pill" id="refreshPill">React Refresh loading…</span>
          <span class="pill" id="blobPill">Blob-ESM</span>
        </div>
        <div id="preview">
          <div id="root"></div>
          <div id="about"><div class="markdown-body"></div></div>
        </div>
      </div>
    </div>

    <!-- Boot: all JS lives in src/ -->
    <script type="module" src="src/boot.ts"></script>
  </body>
</html>
